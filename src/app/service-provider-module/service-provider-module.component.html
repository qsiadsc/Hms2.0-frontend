<nav class="breadcrumb">
  <span *ngIf="serviceProviderChecks[0].searchServiceProvider == 'F'">{{'serviceProvider.heading'|translate}} ></span>
  <span *ngIf="serviceProviderChecks[0].searchServiceProvider == 'T'" [routerLink]="['/serviceProvider/search']" class="serviceProviderParent">{{'serviceProvider.heading'|translate}} ></span>
  <span *ngIf="addMode" class="active serviceProviderActive" href="javascript:void(0)">{{breadCrumbText}}</span>
  <span class="active serviceProviderActive" *ngIf="!addMode" href="javascript:void(0)">{{breadCrumbText}}</span>
</nav>

<div class="section-heading">
  <h2>{{'serviceProvider.heading'|translate}} -
    <span>{{serviceProviderHeading}}</span>
    <span *ngIf="spCommentImportance" class="comment-fm">
      <i class="fa fa-flag" data-toggle="modal" aria-hidden="true" data-target="#spImpComments" (click)="getImpCommentList()"
        style="cursor:pointer"></i>
      <div class="comment-top">
        <p>{{spCommentText}}</p>
      </div>
    </span>
  </h2>
</div>
<!-- Section Heading Ends -->

<form [formGroup]="FormGroup">
  <div class="web-reg">
    <button id="sp_save" *ngIf="addMode" title="SAVE" class="btn green-btn-add savebtn" type="submit" (click)="saveServiceProviderData()"
      [ngClass]="{'disabled':disableAddBtn}">{{'button.save' | translate}}</button>
    <button id="sp_edit" *ngIf="viewMode && serviceProviderChecks[0].editServiceProvider == 'T'" title="Service Provider - Edit Details"
      class="btn green-btn-add savebtn" type="button" (click)="enableEditMode()">{{'button.edit' | translate}}</button>
    <button id="sp_update" *ngIf="editMode" title="Service Provider - Update Details" class="btn green-btn-add savebtn" type="button"
      (click)="saveServiceProviderData()" [ngClass]="{'disabled':disableAddBtn}">{{'button.update' | translate}}</button>
  </div>
</form>

<app-general-information [ServiceProviderGeneralInformationFormGroup]="FormGroup.controls.ServiceProviderGeneralInformationFormGroup"
  [serviceProviderChecks]="serviceProviderChecks" [serviceProviderViewMode]="viewMode" [serviceProviderEditMode]="editMode"></app-general-information>
<app-billing-address [disciplineKey]="disciplineKey" [serviceProviderChecks]="serviceProviderChecks" [providerKey]="providerKey"
  [serviceProviderAddMode]="addMode" [serviceProviderViewMode]="viewMode" [serviceProviderEditMode]="editMode"></app-billing-address>
<div class="row clear">
  <app-eligibility-history [disciplineKey]="disciplineKey" [serviceProviderChecks]="serviceProviderChecks" [providerKey]="providerKey"
    [serviceProviderAddMode]="addMode" [serviceProviderViewMode]="viewMode" [serviceProviderEditMode]="editMode"></app-eligibility-history>
  <app-speciality [disciplineKey]="disciplineKey" [serviceProviderChecks]="serviceProviderChecks" [providerKey]="providerKey"
    [serviceProviderAddMode]="addMode" [serviceProviderViewMode]="viewMode" [serviceProviderEditMode]="editMode"></app-speciality>
</div>
<div class="grid-box">
  <div class="grid-heading">
    <h3>{{'button.comments'|translate}}</h3>
  </div>
  <div id="serviceProviderCommentContainer" class="tab-pane fad">
    <div class="grid-inner">
      <div class="form-row">
        <form [formGroup]="serviceProviderCommentForm">
          <label>{{'common.addcomment'|translate}}<span class="required"> *</span></label>
          <div class="add-comments">
            <div class="row">
              <div class="col-sm-5">
                <textarea id="spc_provComTxt" class="notInCaps fm-txt form-control comment-textarea" name="provComTxt" formControlName="provComTxt"></textarea>
                <show-errors [control]="serviceProviderCommentForm.controls.provComTxt"></show-errors>
              </div>
              <div class="col-sm-2">
                <label class="check-lb">
                  <input id="spc_claimImportance" type="checkbox" formControlName="claimImportance" />
                  <span class="check-flag">
                    <i class="fa fa-flag" aria- hidden="true"></i>
                  </span>{{'common.importance'|translate}}
                </label>

              </div>
              <div *ngIf = "showCommentBussnsType" class="col-sm-2">
                <label>{{'serviceProvider.department' | translate}}<span class="required"> *</span></label>
                <ng2-completer 
                  formControlName="spCommentGroupKey" 
                  [ngClass]="{'disableInput':disableBsnsType}"
                  [datasource]="userGroupData" 
                  [minSearchLength]="0" 
                  [openOnFocus]="true"
                  [fillHighlighted]="false" 
                  [placeholder]="'Search Department'" 
                  [textSearching]="'Please wait...'"
                  [inputClass]="'form-control'" 
                  [clearUnselected]="true"
                  (selected)="onSelect($event)"> >
                </ng2-completer>
                <show-errors [control]="serviceProviderCommentForm.controls.spCommentGroupKey"></show-errors>
              </div>

              <div class="col-sm-2">
                <label>{{'card.card-eligibility.expirydate' | translate}}</label>
                <div class="calender-field">
                    <my-date-picker id="c_expiryDate" placeholder="{{'common.date-placeholder' | translate}}"
                        [options]="myDatePickerOptions" name="expiry_date"
                        [ngClass]="expired  ? 'expired' : 'notExpired'" formControlName="expiry_date"
                        (inputFocusBlur)="changeDateFormat($event, 'expiry_date' ,'serviceProviderCommentForm')">
                    </my-date-picker>
                    <show-errors [control]="serviceProviderCommentForm.controls.expiry_date"></show-errors>
                </div>
              
              </div>
              <div class="col-sm-1 text-right">
                <button title="{{'common.add' | translate}}" id="btnAddServiceProviderCommentAddMode" *ngIf="addMode && serviceProviderChecks[0].addSPComments == 'T'"
                  class="green-btn-add btn" (click)="addServiceProviderComment(serviceProviderCommentForm,'serviceProvider-comments','addMode')">
                  <i class="fa fa-plus"></i>{{'button.add'|translate}}</button>
                <button title="{{'common.add' | translate}}" id="btnAddServiceProviderCommentEditMode" *ngIf="!addMode && serviceProviderChecks[0].addSPComments == 'T'"
                  class="green-btn-add btn" (click)="addServiceProviderComment(serviceProviderCommentForm,'serviceProvider-comments','editMode')">
                  <i class="fa fa-plus"></i>{{'button.add'|translate}}</button>
              </div>
            </div>

              <!-- div created to show File Upload field. -->
              <div>
              <div class="col-md-3 col-xs-12">
                <label>{{'common.documentName' | translate}}</label>
                <input style="display: none" type="file" (click)="serviceProviderCommentsFileInput.value = null" (change)="serviceProviderFileUpload($event)" #serviceProviderCommentsFileInput>
                <input formControlName="serviceProviderCommentsDocumentName" class="fm-txt form-control datepicker" type="text" disabled>
                <ul *ngIf="error.isError==true" class="validation-errors">
                    <li style="color: red">{{error.errorMessage}}</li>
                </ul>
                <ul *ngIf="error1.isError==true" class="validation-errors">
                    <li style="color: red">{{error1.errorMessage}}</li>
                </ul>                
              </div>
              <!-- div is for add and remove functionality. -->
              <div class="col-md-3 col-xs-12">
                    <button class="btn green-btn" (click)="serviceProviderCommentsFileInput.click()">{{'common.selectFile' | translate}}</button>
                    <button *ngIf="showRemoveBtn" (click)="removeServiceProviderCommentsFile()" class="btn red-btn ">{{'common.remove' | translate}}</button>
              </div>
            </div>
          </div>
          <!-- Add Comments Ends -->
        </form>
        <!-- Add Comments Form Ends -->
      </div>
      <!-- Form Row Ends -->

      <div class="form-row">
        <div class="row">
          <div class="col-md-12 col-xs-12 table-col">
            <div class="table-responsive">
              <table id="serviceProvider-comments" datatable [dtOptions]="dtOptions['serviceProvider-comments']" [dtTrigger]="dtTrigger['serviceProvider-comments']"
                class="table table-bordered table-stripped">
                <thead>
                  <tr>
                    <th width="10%">{{'claims.claims-view.claims-messages.messages.claim-comment.data-table.date' | translate}}</th>
                    <th class="amount_right" width="25%">{{'claims.claims-view.claims-messages.messages.claim-comment.data-table.user-id' | translate}}</th>
                    <th class="amount_right" width="25%">{{'claims.claims-view.claims-messages.messages.claim-comment.data-table.department' | translate}}</th>
                    <th class="amount_right" width="25%">{{'claims.claims-view.claims-messages.messages.claim-comment.data-table.notes' | translate}}</th>
                    <th class="amount_right" width="25%">Expiry Date</th>
                    <th class="amount_right" width="25%">{{'common.importance'|translate}}</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let serviceProviderComment of serviceProviderComments">
                    <td>{{ serviceProviderComment.createdOn|dateFormate }}</td>
                    <td class="amount_right">{{ serviceProviderComment.username}}</td>
                    <td class="amount_right">{{ serviceProviderComment.department}}</td>
                    <td class="amount_right">{{ serviceProviderComment.provComTxt }}</td>
                    <td class="amount_right">{{ serviceProviderComment.expiredOn }}</td>
                    <td class="amount_right"  *ngIf="serviceProviderComment.claimImportance == 'Y'">
                      <span class="flag">
                        <i class="fa fa-flag" aria-hidden="true"></i>
                      </span>
                    </td>
                    <td *ngIf="serviceProviderComment.claimImportance == 'N'"></td>
                  </tr>
                </tbody>
              </table>
            </div>
            <!-- Table Ends -->
          </div>
        </div>
      </div>
      <!-- Form Row ENds -->
    </div>
    <!-- Grid Inner Ends -->
  </div>
  <!--Claim Comments TAB ENDS -->
</div>

<div id="spImpComments" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button id="btncloseSearchCompany" type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">{{'serviceProvider.service-provider-comment'|translate}}
          <span class="comment-fm">
            <i class="fa fa-flag" style="color:red;" aria-hidden="true"></i>
          </span>
        </h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-12 col-xs-12 table-col">
            <div class="table-responsive">
              <table id="spImpCommentsList" class="table table-bordered table-stripped"> </table>
            </div>
            <!-- Table Ends -->
          </div>
        </div>
      </div>
      <!-- Modal Body Ends -->
      <div class="modal-footer">
        <button id="closeSearchCompany" type="button" class="btn grey-btn" data-dismiss="modal">{{'button.close' | translate}}</button>
      </div>
    </div>
    <!-- Modal Content Ends -->
  </div>
</div>
<div *ngIf = "showLoader" class="loader-outer">
    <div class="cube-wrapper">
        <div class="cube-folding">
            <span class="leaf1"></span>
            <span class="leaf2"></span>
            <span class="leaf3"></span>
            <span class="leaf4"></span>
        </div>
        <span class="loading" data-name="Loading">{{loaderPlaceHolder}}</span>
    </div>
</div>